---
name: SelectorToLogs
start:
  domain: k8s
  matches: ['{{print .Spec.Selector}}']
goal:
  domain: loki
result:
  query: |-
    {{- $logType := k8sLogType .Namespace -}}
    {
      "Tenant": "{{$logType}}",
      "LogQL": "{kubernetes_namespace_name=\"{{.Namespace}}\"} | json
        {{- range $k, $v := .Spec.Selector.MatchLabels}} | kubernetes_label_{{lokiFixLabel $k}}=\"{{$v}}\"{{end -}}"
    }
  class: 'loki/{{ k8sLogType .ObjectMeta.Namespace }}'
---
name: PodToLogs
start:
  domain: k8s
  classes: [Pod.]
goal:
  domain: loki
result:
  query: |-
    {{- $logType := k8sLogType .Namespace -}}
    {
      "Tenant": "{{$logType}}",
      "LogQL": "{kubernetes_namespace_name=\"{{.Namespace}}\",kubernetes_pod_name=\"{{.Name}}\"} | json"
    }
  class: 'loki/{{ k8sLogType .ObjectMeta.Namespace }}'
---
name: SelectorToPods
start:
  domain: k8s
  matches: ['{{print .Spec.Selector}}']
goal:
  domain: k8s
  classes: [Pod.]
result:
  query: |-
    {"Namespace":"{{.Namespace}}","Labels":{{ .Spec.Selector.MatchLabels | json -}} }
---
name: EventToObject
start:
  domain: k8s
  classes: [Event.]
goal:
  domain: k8s
result:
  query: |-
    {"Namespace":"{{.InvolvedObject.Namespace}}","Name": "{{.InvolvedObject.Name}}"}
  class: '{{k8sClass .InvolvedObject.Kind .InvolvedObject.APIVersion}}'
---
name: ObjectToEvent
start:
  domain: k8s
goal:
  domain: k8s
  classes: [Event.]
result:
  query: |-
    { "Fields": {{kvmap "involvedObject.namespace" .Namespace "involvedObject.name" .Name | json}} }
